NFC Reader prototype
==========
A Raspberry Pi Zero based NFC reader prototype to talk to MuseumOS.

Hardware
--------
* ACR122 Contactless Reader

Software
--------
* Python

RaspberryPi
----

When running on a Raspberri Pi, you need to install some packages.

`$ xargs -a pkglist.txt sudo apt install`

`$ pip3 install -r requirements.txt`

If the reader isn't showing up, solve it using this:
http://enjoy-rfid.blogspot.com.au/2015/03/raspberry-pi-nfc.html

Which gets you to create a blacklist file:
<code>/etc/modprobe.d/raspi-blacklist.conf</code>

	blacklist pn533
	blacklist nfc
	
**NTP time server**

To set an NTP time server on Raspbian Stretch, edit the servers in `/etc/systemd/timesyncd.conf`:

```bash
[Time]
NTP=your.servername.goes.here
FallbackNTP=0.debian.pool.ntp.org 1.debian.pool.ntp.org 2.debian.pool.ntp.org 3.debian.pool.ntp.org
```

Then turn on NTP by running: `$ timedatectl set-ntp true`

And check its status: `$ timedatectl status` (it might take a minute or so to sync, and or may require a reboot)

**Wifi**

To add wireless hotspot information, run:

<code>$ wpa_passphrase ssid-name passphrase > tmp.txt</code>

<code>$ sudo wpa_supplicant -B -i wlan0 -c tmp.txt</code>

You might need to restart the Pi, but it should be able to connect then.

***Wifi Troubleshooting***

I'm not sure the above commands will set up automatic connect, you might need to add something like this to /etc/network/interfaces:

	# comment out these lines that are there by default
	#iface wlan0 inet manual
	#wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf

	auto wlan0
	iface wlan0 inet dhcp

	wpa-ssid the_ssid
	#psk="the_passphrase" # just for reference
	wpa-psk <long hex string generated by wpa_passphrase in tmp.txt>

**Wifi - connect to multiple networks**

If you'd like your pi to connect to home/work/hackerspace networks, you'll need to use a wpa-roam setup.

The two files you need to edit are <code>/etc/network/interfaces</code> and <code>/etc/wpa_supplicant/wpa_supplicant.conf</code>

	# /etc/network/interfaces
	
	auto lo
	iface lo inet loopback
	iface eth0 inet dhcp

	allow-hotplug wlan0
	iface wlan0 inet manual
	wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf

	iface networkName1 inet dhcp
	iface networkName2 inet dhcp

And then use the same names here:

	# /etc/wpa_supplicant/wpa_supplicant.conf
	
	ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
	update_config=1

	network={
	    ssid="funnySSID"
	    psk="superSekret"
	    id_str="networkName1"
	}

	network={
	    ssid="workSSID"
	    psk="suuuuuuperSekret"
	    id_str="networkName2"
	}
	
Restart the Pi and it should auto-connect to the network.

**GPIO pins**

Using *wiringpi2*

<code>$ sudo apt-get install python-dev python-pip</code>

<code>$ sudo pip install wiringpi2</code>

Then with the RaspberryPi pointing with the SD card to the top, connect the buzzer to:

* Ground to the third pin down from the top on the right column.
* Power to the eighth pin down from the top on the right column.

Run the card reader on boot
---

To get this script to run at boot, add the following line to <code>/etc/rc.local</code>

<code>echo -n 'p\nc\n' | sudo -H -u pi python /home/pi/code/nfc-reader-pi-zero/nfc_reader.py | logger -t nfc_reader &</code>

The ```echo``` command enters 'p' for production, and 'c' for checkin.
It then tries to run the python script, and output that to logger with the tag 'keymaster'. The ```&``` symbol makes it run in the background.


ESP8266
---

[Damien](https://github.com/33d) has ported this project to an [ESP8266](https://en.wikipedia.org/wiki/ESP8266) running the Arduino toolchain.

See his project: [keymaster-esp8266](https://github.com/33d/keymaster-esp8266)


Who
---

By [Pix](https://twitter.com/xiq), [Simon](https://twitter.com/sighmon) & [Damien](https://github.com/33d).

[Read more on the wiki](http://hackerspace-adelaide.org.au/wiki/Key_Master)
